[gd_scene load_steps=11 format=2]

[ext_resource path="res://Scripts/Map.gd" type="Script" id=1]
[ext_resource path="res://Scenes/Player Structures/Turrets/Machinge Gun Turret/MachineGunTurret.tscn" type="PackedScene" id=2]
[ext_resource path="res://Scenes/Player Structures/Base.tscn" type="PackedScene" id=3]
[ext_resource path="res://Scenes/Enemies/BaseEnemy.tscn" type="PackedScene" id=4]
[ext_resource path="res://Scenes/Player Structures/Turrets/Snipe Turret/SnipeTurret.tscn" type="PackedScene" id=5]
[ext_resource path="res://Scenes/Player Structures/Turrets/Splash Turret/SplashTurret.tscn" type="PackedScene" id=6]

[sub_resource type="GDScript" id=6]
script/source = "extends Navigation2D

onready var cp = $CollisionPolygon2D

func _ready():
	add_inner_polygon(cp.polygon, cp.global_transform)


# NOTES
# Player structures need to have gaps filled between them, maybe by merging a rectangle in between them.
# Gaps between inner shapes and the perimeter of the entire navpoly needs to be filled.


func add_inner_polygon(polygon_: PoolVector2Array, transform_: Transform2D):
	var polygon = NavigationPolygon.new()
	var navpoly = $NavigationPolygonInstance.navpoly
	for i in navpoly.get_outline_count():
		polygon.add_outline(navpoly.get_outline(i))
	polygon.add_outline(polygon_)
	polygon.make_polygons_from_outlines()
	$NavigationPolygonInstance.navpoly = polygon
"

[sub_resource type="NavigationPolygon" id=7]
vertices = PoolVector2Array( 933, 337, 1313, 529, 826, 473, 1422, 312, 2259, -546, 2718, 1342, 789, 127, 1005, 124, 1162, 47, 1274, 90, 920, -78, 604, 89, 522, 38, 448, -24, 518, 191, 579, 384, 423, 230, 53, 490, 1083, -115, 686, 554, 87, 50, 345, 18 )
polygons = [ PoolIntArray( 0, 1, 2 ), PoolIntArray( 3, 4, 5, 1 ), PoolIntArray( 0, 2, 6, 7 ), PoolIntArray( 8, 9, 0, 7 ), PoolIntArray( 10, 7, 6, 11, 12, 13 ), PoolIntArray( 14, 12, 11, 15 ), PoolIntArray( 4, 3, 9 ), PoolIntArray( 16, 14, 15, 17 ), PoolIntArray( 4, 9, 8, 18 ), PoolIntArray( 19, 2, 1, 5 ), PoolIntArray( 19, 5, 17 ), PoolIntArray( 15, 19, 17 ), PoolIntArray( 16, 17, 20, 21 ), PoolIntArray( 13, 21, 20 ), PoolIntArray( 13, 20, 4 ), PoolIntArray( 13, 4, 18, 10 ) ]
outlines = [ PoolVector2Array( 2259, -546, 87, 50, 53, 490, 2718, 1342 ), PoolVector2Array( 1274, 90, 1422, 312, 1313, 529, 933, 337 ), PoolVector2Array( 1083, -115, 1162, 47, 1005, 124, 920, -78 ), PoolVector2Array( 826, 473, 789, 127, 604, 89, 579, 384, 686, 554 ), PoolVector2Array( 448, -24, 522, 38, 518, 191, 423, 230, 345, 18 ) ]

[sub_resource type="CircleShape2D" id=4]
radius = 100.0

[sub_resource type="GDScript" id=2]
script/source = "extends Node

var stop = false

func _process(_delta):
	if MapRefs.map && !stop:
		for e in get_children():
			MapRefs.map.add_enemy(e)
		stop = true
"

[node name="Test Map" type="Node2D"]
script = ExtResource( 1 )

[node name="PlayerCamera" type="Camera2D" parent="."]
position = Vector2( 1082, 198 )
current = true
zoom = Vector2( 2, 2 )

[node name="MapContent" type="Node" parent="."]

[node name="Terrain" type="StaticBody2D" parent="MapContent"]

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="MapContent/Terrain"]
polygon = PoolVector2Array( -3, -8, 1, -491, 1641, -495, 1406, -285, 807, -84, 643, 35, 421, 71, 313, -33, 154, -54, 65, 18, 35, 170, 84, 391, 294, 549, 590, 594, 919, 361, 1158, 346, 1230, 441, 1305, 628, 1716, 816, 1762, 971, -1, 982 )

[node name="Navigation2D" type="Navigation2D" parent="MapContent"]
script = SubResource( 6 )

[node name="NavigationPolygonInstance" type="NavigationPolygonInstance" parent="MapContent/Navigation2D"]
navpoly = SubResource( 7 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="MapContent/Navigation2D"]
polygon = PoolVector2Array( 1602, -140, 1687, 136, 1442, 23 )
disabled = true

[node name="PlayerStructures" type="Node" parent="."]

[node name="Base" parent="PlayerStructures" instance=ExtResource( 3 )]
position = Vector2( 248, 215 )

[node name="MachineGunTurret" parent="PlayerStructures" instance=ExtResource( 2 )]
position = Vector2( 592, 207 )
collision_layer = 1
collision_mask = 1

[node name="SnipeTurret" parent="PlayerStructures" instance=ExtResource( 5 )]
position = Vector2( 701, 352 )

[node name="SplashTurret" parent="PlayerStructures" instance=ExtResource( 6 )]
position = Vector2( 825, 94 )

[node name="CollisionShape2D2" type="CollisionShape2D" parent="PlayerStructures/SplashTurret"]
shape = SubResource( 4 )
disabled = true

[node name="Enemies" type="Node" parent="."]
script = SubResource( 2 )

[node name="BaseEnemy" parent="Enemies" instance=ExtResource( 4 )]
position = Vector2( 908, 46 )

[node name="BaseEnemy2" parent="Enemies" instance=ExtResource( 4 )]
position = Vector2( 1687, -135 )

[node name="BaseEnemy3" parent="Enemies" instance=ExtResource( 4 )]
position = Vector2( 1704, 49 )

[node name="UI" type="Node" parent="."]
